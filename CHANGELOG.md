# Changelog

## 相较于原版 [Easydict](https://github.com/tisfeng/Easydict) 的优化

### 日语词典引擎增强

- **全新 AI 词典渲染系统**：新增基于 JSON 模板的结构化词典渲染，替代纯 Markdown 输出，呈现更接近专业词典的排版效果。
- **漢字【ひらがな】标准词头格式**：严格遵循日语辞书标准——含汉字词条显示「漢字【ひらがな】」，纯假名词条直接显示，片假名外来语可附注英文原词。
- **动词活用形展示**：查词结果自动包含动词的活用变化（て形、た形、ます形、辞書形等），以 grammar-note 区块清晰呈现。
- **品词・JLPT 标签**：每个词条自动标注词性（名词、五段動詞、い形容詞等）及 JLPT 等级（N5～N1）。
- **纯平假名歧义处理**：输入纯平假名（如「あう」）时，自动展开所有可能的汉字写法（会う、合う、遭う），每个写法独立生成词卡。
- **汉字多读音分离（音読み / 訓読み）**：同一汉字不同读音严格拆分为独立词条。例如「処」→ 処【ところ】（地方、场所）和 処【しょ】（处理、处置）分开展示，杜绝读音与释义混淆的致命错误。
- **片假名外来语关联词**：片假名词条附带 related_terms，展示同义的汉字或和语表达。

### 日语句子解析增强

- **语法逐段拆解**：输入日语句子时，自动按语素分段，逐一标注语法角色（主题标记、目的语标记、动词て形等）及解释。
- **智能句子/单词判定**：基于助词（は、が、を、に、で等）和谓语词尾（ます、です、た、だ、ている）自动区分「句子分析」与「词典查询」模式。
- **关键词注音**：句子解析结果中的关键词使用 HTML Ruby 标注（振り仮名），汉字上方显示假名读音。

### AI 词典 Prompt 优化

- **专用 System Prompt**：为日语词典查询设计了独立的结构化 System Prompt，输出严格 JSON 格式，确保渲染一致性。
- **词典/句子/翻译三模式分流**：根据查询类型自动选择 dictMessages、sentenceMessages 或 translationMessages，各走专用 Prompt 路径。
- **Few-shot 日语翻译示例**：内置日中翻译 few-shot 样本（如「ちっちいな~」→「好小啊~」），提高口语和非标准表达的翻译质量。

### 渲染与视觉优化

- **京都风格排版主题**：采用明朝体（Hiragino Mincho ProN / YuMincho）呈现日语内容，宋体（Songti SC）呈现中文内容，避免 CJK 字形混用。
- **多主题支持**：提供 modern-clean、mac-dictionary、oled-dark、e-ink 四套主题，均适配亮色/暗色模式。
- **流式渲染防闪烁**：流式输出过程中锁定容器最小高度（单调递增），避免内容替换时的视觉跳动。
- **结构化 HTML 优先**：渲染管线优先检测 JSON 模板 → 结构化 HTML（dict-wrapper）→ Markdown 回退，确保词典内容始终以最佳格式展示。
